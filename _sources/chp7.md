# Tableau 七、多边形地图和背景图地图：设置地理信息（自定义地图码导入、设置地图源）

Created: April 3, 2022 7:53 AM
Tags: Dr. Fangli Ying

### 1.多边形地图

多边形地图是高级的填充地图。

### 1.1多边形地图的相关概念

多边形地图是对填充地图的一种补充，基于地理编码和数据文件绘制多边形区域，实现自定义的填充地图。

### 1.2英国国家公园多边形地图

打开“国家公园地理数据.xlsx”。

将工作表【国家公园多边形数据】拖入右侧。多边形地图必备4个元素。

- 纬度：数据点所在位置。
- 经度：数据点所在位置。
- 公园名称：多边形区域的名称。
- 点ID：点ID是将纬度和经度形成的点按顺序连接起来，形成多边形区域。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623154820718.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623154820718.png)

### 修改地理角色数据

【经度】和【纬度】为数字格式，所以分别点击标记，【地理角色】——【纬度】，【地理角色】——【经度】

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155152523.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155152523.png)

### 做多边形地图

双击【度量】下【经度】和【纬度】

取消【分析】——【聚合度量】的勾选。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155551468.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155551468.png)

标记下【自动】中选择【多边形】。

将【点ID】拖到【路径】上，将【公司名称】拖到【颜色】上。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155932606.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623155932606.png)

多边形区域是按照点ID的顺时针方向形成的。

【地图】——【地图层】

【样式】选择【普通】，地图里可以露出图表。

【冲蚀】选择20%。

【地图层】勾选【海岸线】和【地名】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623160604169.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623160604169.png)

### 添加标签

注意，多边形地图创建出来后，【大小】和【标签】无法设置。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623160809945.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623160809945.png)

只能通过添加注释添加标签。右击多边形区域，【添加注释】——【标记】，填写公园名称“科恩戈姆国家公园”，设置为宋体，8号字体。右击公园名称，框选择“无”，阴影选择“无”，线选择“无”。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623161158259.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623161158259.png)

修改工作表为“英国国家公园多边形地图”，搞定。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623161642555.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623161642555.png)

### 2.设置地理信息

- 自定义地理码导入
- 设置地图源

### 2.1自定义地理编码导入

自定义地理编码只能制作符号地图，不能做填充地图。

自定义地理编码的文件是csv格式，里面包括地理角色、纬度和经度。

有3种自定义地理编码：

### 扩展现有的地理角色

Tableau默认只公开人口在1万且政府公开的城市。所以城市信息不够，需要补充，可以使用这种方法。通过CSV文件按照固定格式添加，然后导入。

以下是csv文件的内容。注意数据列名是固定的，也就是第一行必须是英文且大写。这样以后想要扩展现有地理角色，只需在下面的行继续录入即可。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623163513167.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623163513167.png)

【地图】——【地理编码】——【导入自定义自定义地理编码】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623162638291.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623162638291.png)

【从目录中的所有CSV文件导入】选择文件夹“自定义编码扩展现有城市”（注意是文件夹）。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623163000216.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623163000216.png)

打开文件“扩展现有城市名称测试.xlsx”

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164029951.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164029951.png)

修改地理角色。右击【国家/地区】——【地理角色】——【国家/地区】。

右击【城市】——【地理角色】——【城市】，可以发现城市旁边的标记不一样，说明对现有的地理信息进行了扩展。

右击【省/市/自治区】——【地理角色】——【省/市/自治区】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164212773.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164212773.png)

双击【省/市/自治区】，显示地图。双击【城市】，显示要扩展的城市。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164845510.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623164845510.png)

### 自定义编码添加新角色

想导入大学的信息。

【地图】——【地理编码】——【导入自定义自定义地理编码】，弹出对话框，点击【是】，移除现有自定义定理编码。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165529592.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165529592.png)

【从目录中的所有CSV文件导入】选择文件夹“自定义编码添加新角色-大学”。这是csv文件的内容。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165748935.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165748935.png)

打开文件“南京学校测试.xlsx”。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165953425.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623165953425.png)

右击【维度】下【大学】——【地理角色】——【大学】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623170052202.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623170052202.png)

双击【大学】，将【大学】拖到【标签】上。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623170424652.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623170424652.png)

### 添加新分层结构

上面是按照国家——省市自治区——县的分层结构建立，也可以创建新的分层结构，比如国家——国家公园——公园小景区的结构。

【地图】——【地理编码】——【导入自定义自定义地理编码】，【从目录中的所有CSV文件导入】选择文件夹“自定义编码”。这是csv文件内容：

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181316851.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181316851.png)

选择【国家多边形数据】数据，右击【公园名称】——【地理角色】——【国家公园】——【公园名称】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181714917.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181714917.png)

双击【公园名称】，将公园名称拖到【标签】上。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181911186.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623181911186.png)

### 2.2设置地图源

【地图】——【背景地图】下有

- 无
- 脱机
- Tableau
- 地图服务
- 设置为默认值

选择Tableau是选择Tableau联机地图。

### 地图服务

地图服务可以选择wms服务器作为地图源。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623182239976.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623182239976.png)

【地图】——【背景地图】——【地图服务】，点击【导入】，选择“WMS for the GEBCO global bathymetric grid.tms”，导入后点击关闭。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183126929.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183126929.png)

【地图】——【地图层】，选择合适的地图层。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183439284.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183439284.png)

【地图】——【背景地图】——【地图服务】，点击【导入】，选择“M Blue Green.tms”。风格如下：

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183850715.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210623183850715.png)

如果点击【地图】——【背景地图】——【设置为默认值】，则该地图源会变为默认格式，以后Tableau打开都使用该地图源。

### 3.背景图地图

背景图地图是高级的符号地图。

Tableau可以添加图片作为背景图像。可以通过自定义图像更换图像的展示形式，为地图提供更多的位置信息。对Tableau不支持的地图进行扩展，展示更为详尽的地图信息。

背景图地图，第一要有地图图像；第二要有跟图像相匹配的数据表。

### 3.1香港地铁背景图地图

利用交互式的方式创建香港两条地铁的地图。

导入数据“Hong Kong MTR Coordinate Data.xlsx”。

数据列名有地铁线路Line，地铁站名Station，X和Y坐标。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174022743.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174022743.png)

在工作表中，【地图】——【背景图像】，选择“Coordinates (Hong Kong MTR Coordinate Data)”。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174512347.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174512347.png)

点击【添加图像】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174638855.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624174638855.png)

点击【浏览】，选择图片“Hong Kong MTR.gif”。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417471888.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417471888.png)

找到图片文件位置，右击【属性】，看图片宽度为840，高度为623。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624175139683.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624175139683.png)

在【添加背景图像】对话框里，【X字段】下选择X，右填写宽度840，【Y字段】上填写高度623。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417532581.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417532581.png)

点击【选项】，勾选【始终显示整个图像】，点击【应用】，点击【确定】。

在【背景图像】对话框里点击【确定】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624175511788.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624175511788.png)

将【X】拖到列，将【Y】拖到行，将【Line】拖到【颜色】，将【Station】拖到【详细信息】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417580543.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/2021062417580543.png)

点击【颜色】——【编辑颜色】，选择"Kwun Tong Line"，选择绿色色块，点击【应用】，点击【确定】。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624180253220.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624180253220.png)

点击【形状】，选择实心圆。

![Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624180447499.png](Tableau%20%E4%B8%83%E3%80%81%202cf3e/20210624180447499.png)