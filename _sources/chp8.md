# Tableau 八、数据分层、数据分组、数据集

Created: April 3, 2022 7:53 AM
Tags: Dr. Fangli Ying

### 1.数据分层（层级）结构

### 1.1分层结构的概念与意义

分层结构是[维度](https://so.csdn.net/so/search?q=%E7%BB%B4%E5%BA%A6&spm=1001.2101.3001.7020)之间自上而下的组织形式。

[Tableau](https://so.csdn.net/so/search?q=Tableau&spm=1001.2101.3001.7020)默认包含对某些字段的分层结构，比如日期、时间、地理角色。

以日期为例，包含年、季度、月、日等数据分层结构。

打开“全球超市订单数据.xlsx”。

将两个工作表数据拖到右侧。联结为内部联结。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210624182745645.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210624182745645.png)

将【利润】拖到【行】，将【订单日期】拖到【列】，点击【年(订购日期)】右侧的＋，会往下分层（称之为**下钻**），并变成-，点击-，会把层折叠（称为**上钻**）。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210624183141842.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210624183141842.png)

### 1.2分层结构的创建与使用案例

打开“人工坐席接听数据.xlsx”。

### 中心和人工服务接听量柱形图

新建工作表2，右击【中心】——【分层结构】——【创建分层结构】。

命名为【层级】。

【维度】下变化如下

将字段【部】、【组】、【班】，拖到【中心】下面，注意顺序，上下顺序就是层级顺序。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625095540477.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625095540477.png)

将【中心】放到【列】中，将【人工服务接听量】放到【行】中，将【人工服务接听量】放到【标签】上。

点击【整个视图】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100012655.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100012655.png)

右击【总和(人工服务接听量)】——【设置格式】，点击【数字】

![Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510024888.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510024888.png)

【数字(自定义)】，设置小数位数为0，【显示单位】为千。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100406549.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100406549.png)

点击【列】里的【中心】左边的+，逐级下钻，进行分析，发现有【未知】字段数据太高，属于异常，排除掉。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510080674.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510080674.png)

点击【未知】的柱形，点击【排除】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100939869.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625100939869.png)

分析发现有两个班的数据比较高。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101121118.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101121118.png)

### 中心、日期和平均呼入通话时长折线图

新建工作表3，将【日期】拖入【列】，选择格式为【天】。

将【中心】拖入【行】，将【平均呼入通话时长】拖入行。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101704850.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101704850.png)

点击【中心】左边的+，下钻到【部】，并继续下钻，可以到【组】，到【班】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101840479.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625101840479.png)

不想用层级的话，右击【移除分层结构】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102034856.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102034856.png)

### 第二种创建分层结构方式

将字段【部】拖到字段【中心】上，自动打开【创建分层结构】，命名为【层级】。如果字段上下顺序不对，则拖动调整。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102315453.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102315453.png)

右击【组】——【分层结构】——【添加到分层结构】，选择【层级】，则自动排到【层级】的最下面。

不想【组】在层级里，就直接把【组】往外拖。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102454737.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102454737.png)

注意，层级不能嵌套，但可以并列。

比如新建【层级2】，【层级2】不能放到【层级】里面。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102844113.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625102844113.png)

### 2.数据分组

### 2.1数据组创建及使用

组是维度成员或度量的离散值的组合。

通过分组，可以实现维度成员的重新组合，以及度量值按范围的分类。

字段图标是回形针图标。

在Tableau里，归类重组维度成员有很多种方式，分组是其中最常见和最快速方式。

注意，组不能创建计算字段，不能出现在公式中。

新建工作表4。

将【班】拖到行中，将【人工服务接听量】放到列中。点击【交换行和列】。

发现13班和13班（15批新人）属于一个班。其他也有可以合到一个组的情况。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625103757861.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625103757861.png)

### 创建分组

创建分组有两种方式：

一是右击【班】——【创建】——【组】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104145732.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104145732.png)

二是在图形里右击【组】（注意，要点击图形，而不是字段）。这里使用第二种方法。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510424210.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062510424210.png)

出现【创建组】的对话框，点击【应用】和【确定】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104832909.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104832909.png)

### 编辑组

右击带有回形针图标的【班(组)】——【编辑组】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104518273.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625104518273.png)

将【13班(15批新人)】拖到组【13班】下，如果组名不合适，可以右击组名——【重命名】。

按ctrl键，选择【15班】和【15期新人】，点击【分组】，则新建一组。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105241646.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105241646.png)

### 查找和分组

如果字段名称太多，点击【查找】，查找方式有三种

- 包含，属于模糊查找，包含这个字就能找到
- 开头为，则字段开头必须为这个字
- 精确匹配，则查找字为全部字段。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105510344.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105510344.png)

【范围】是查找范围，指的是全部查询还是在某个组内查询，一般选全部。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105836355.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625105836355.png)

想找到所有常白班，【查找成员】输入【白】，【包含】，【范围】选【全部】。点击【查找全部】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110048902.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110048902.png)

找到后，默认结果是被选中的，点击【分组】，重命名为【常白班】。

同样，对【运行班】分组。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110417506.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110417506.png)

将一些字段分组，称为【其他班】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110554758.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110554758.png)

### 修改图表

将【班】拖走，将【班分组】拖到【列】中。点击【交互行和列】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110854449.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625110854449.png)

右击【班分组】，去掉勾选【包含“其他”】

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625111159590.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625111159590.png)

点击【降序】，点击【交互行和列】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625111355529.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625111355529.png)

### 2.2电量销售数据按地理区域分组

打开文件“2014年各省市售电量.xlsx”

中国一般分为七个区：东北，华东，华中，华北，华南，西南和西北。

将省市按照七个区域分组。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625112112512.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625112112512.png)

### 建立地图

新建工作表，右击【维度】下【省市】——【地理角色】——【省/市/自治区】。

双击【省市】，点击【未知】，选择【编辑位置】。（注意，因为第七章中自定义地理编码，如果不移除会导致未知过多，点击【地图】——【地理编码】——【移除自定义地理编码】）

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113008727.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113008727.png)

修改匹配位置，点击【确定】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113312513.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113312513.png)

### 套索选择和建组

将【省市】拖到【标签】上。

点击地图上的【套索选择】按钮，先框选黑龙江，吉林和辽宁三省。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062511362672.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062511362672.png)

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113839943.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113839943.png)

套索选择后，其他省份变灰，只显示选中的省份。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113924754.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625113924754.png)

悬浮在【龙江】上，可以看见3省已选择，点击回形针标识，创建东北组。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625114600544.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625114600544.png)

同样使用套索，选择山东，江苏，安徽，上海，浙江，江西，福建。选择后悬浮在其中一个省份上，点击回形针标识，创建分组华东组。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625114928650.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625114928650.png)

华北组包括内蒙古，河北，山西，北京，天津。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142341806.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142341806.png)

华中组包括河南，湖北，湖南。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142514981.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142514981.png)

西南组包括重庆、四川和西藏。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062514262163.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/2021062514262163.png)

西北组包括新疆、青海、甘肃和宁夏。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142753901.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625142753901.png)

右击【省市(组)】——【编辑组】，重新命名字段名称和群组名称，点击【确定】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625143126694.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/20210625143126694.png)

将【当期值】拖入【大小】。

![Tableau%20%E5%85%AB%E3%80%81%20c9230/672d9500aa924b47b4ccee45c5bca484.png](Tableau%20%E5%85%AB%E3%80%81%20c9230/672d9500aa924b47b4ccee45c5bca484.png)

### 填充地图

新建工作表6，双击【中国地理区域】，将【同期值】拖到【颜色】，点击【颜色】——【编辑颜色】，选择【红色—蓝色发散】，勾选【倒序】。

将【中国地理区域】和【当期值】拖到【标签】上。

右击标签【总和(当期值)】——【设置格式】，【数字(自定义)】，小数位数为0，显示单位为千（K）。

添加说明，【标记】下空白处右击勾选【说明】，双击说明处，输入文字。

重命名工作表6为“各地区用电量”。【工作表】——【导出】——【图像】。

### 各区域用电量标靶图

新建工作表7。

将【中国地理区域】和【省市】拖到【行】，将【当期值】拖到列。

将【月度计划值】拖到【详细信息】。

右击坐标轴——【添加参考线】。

选择【分布】下【分区】。

【计算】里选择【百分比】，修改为【50,100】，百分比类型为【总和(月度计划)】。

【标签】选择【无】。

【格式】里【线】选择黑色直线，填充不修改，点击【确定】。

将【中国地理区域】拖到【颜色】，将【当期值】拖到【标签】。

右击标签【总和(当期值)】——【设置格式】。

修改填充颜色：右击坐标轴下方——【编辑参考线】，选择【向下填充】，然后可以选多种填充颜色。

也可以同时选择【对称】和【反向】。【对称】是指颜色沿着参考线对称。

添加说明，【标记】下空白处右击勾选【说明】，双击说明处，输入文字。

重命名工作表7为“电量销售区域标靶图”。【工作表】——【导出】——【图像】。

### 3.1数据集的相关概念

定义：集是满足某些条件的数据子集，它是维度的部分成员。

图标是

类型

[Untitled](https://www.notion.so/da5d9735e0da44718e714553b1353e2f)

用途

- 集内外成员的对比分析
- 集内部成员的对比分析

### 3.2创建数据集

导入数据“全球超市订单数据.xlsx”

### 创建静态数据集

新建工作表8，找到负利润的国家数据集。

将【国家/地图】拖到【列】，将【利润】拖到【行】。

点击降序图标。

从数据开始为负数的国家开始往后选。

选择好后，悬浮在上面，选择创建集按钮。

修改集的名称，点击【确定】。

可见左侧【度量】下出现【集】。

将【市场】和【细分市场】拖到【列】中

将【利润】拖到【颜色】上。

修改【利润】的颜色，【渐变颜色】为2阶，勾选【倒序】。这样看的更清楚。

按ctrl键，将图表中蓝色的选出来。选好后右击【创建集】，修改集名称如下，点击【确定】。

右击【集】下【负利润国家2】——【编辑集】，将鼠标悬浮在每条记录的后边，会有×，如果不想要该记录，可以点击移除。

悬浮在列名上，也会有×，如果不想要改列，可以进行删除。

点击【清除工作表】。

将【负利润国家2】拖到【列】中，将【利润】拖到【行】中。可以看到集内外变化。

右击【负利润国家2】——【编辑集】，删除【市场】列，点击【应用】和【确定】。

发现图表无变化，因为【市场】列变化不影响数据。

右击【负利润国家2】——【编辑集】，删除【国家/地区】列，点击【应用】和【确定】。

发现数据发生变化。原因是细分市场里的【公司】和【消费者】变成了内，其他的细分市场变成了外。

### 创建动态数据集

新建工作表9。

右击【维度】下【产品名称】——【创建】——【集】。

修改集的名称，勾选【按字段】，选择【利润】【总和】【<=】【0】，点击【加载】，点击【确定】。

将【负利润产品】拖到【行】中，将【利润】拖到【列】中。

点击行中【内/外(负利润产品)】的下拉三角，选择【在集内显示成员】。

### 通过排序方式创建动态数据集

复制工作表9，【清除工作表】，这次找销量在前100的产品。

右击【维度】下【产品名称】——【创建】——【集】。

修改集名称，选择【顶部】，勾选【按字段】，选择【顶部】【100】【数量】【总和】，就是将销量按降序排序，取前100个。点击【确定】。

### 合并集

合并同一个维度的数据。

右击【负利润产品】——【创建合并集】。

修改集名称，左边是【负利润产品】，右边只能选择【销量TOP100】，因为两者都是从【产品名称】这个维度创建而来。

下面有四种选择：

- 合并
- 相交
- 左交
- 右交

选择相交，点击【确定】。

### 通过筛选器创建数据集

将【地区】拖到【筛选器】里，勾选【南亚】【西亚】【中亚】【东亚】【东南亚】，点击【确定】。

右击【筛选器】下的【地区】——【创建集】。

修改集名称，点击【确定】。

### 数据集用于分层结构

将【集】下【亚洲地区】拖到【维度】——【市场】上，弹出【创建分层结构】，修改分层名称，点击【确定】。

### 3.3使用集做对比分析

将【卖情怀的产品】拖到【行】，将【利润】拖到【列】。

选择【行】中【卖情怀的产品】的下拉三角——【在集内显示成员】。

点击【显示标记标签】，显示具体标签数值。