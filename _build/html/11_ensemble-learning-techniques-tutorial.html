
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>11. Ensemble learning &#8212; Introduction to Engineering</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="12 Artificial Neural Networks" href="12_Nerual_Nets_with_Pytorch.html" />
    <link rel="prev" title="10 DBSCAN" href="10_DBSCAN.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Introduction to Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to Introduction to Engineering
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_Introduction_to_Machine_Learning.html">
   1. Introduction to Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_linear_regression.html">
   2. Linear Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_Logistic_regression.html">
   3. Logistic Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_KNN.html">
   4. K nearest Neighbors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_SVM.html">
   5. Support Vector Machine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6_Decision_trees_and_random_forests.html">
   6. Decision Trees &amp; Random Forests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7_Bayesian_methods.html">
   7. Naive Bayesian Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8_k_means.html">
   8. K-Means
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9_Principal_Component_Analysis.html">
   9. Principal Component Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_DBSCAN.html">
   10 DBSCAN
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   11. Ensemble learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_Nerual_Nets_with_Pytorch.html">
   12 Artificial Neural Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_Recurrent_Neural_Networks_Pytorch.html">
   13 Recurrent Neural Networks
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/11_ensemble-learning-techniques-tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/Fangli-Ying/Introduction2Engineering/master?urlpath=tree/11_ensemble-learning-techniques-tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://jupyter.org/hub/hub/user-redirect/git-pull?repo=https://github.com/Fangli-Ying/Introduction2Engineering&urlpath=tree/Introduction2Engineering/11_ensemble-learning-techniques-tutorial.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/Fangli-Ying/Introduction2Engineering/blob/master/11_ensemble-learning-techniques-tutorial.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ensemble-techniques-a-id-2-a-br">
   Ensemble Techniques
   <a id="2">
   </a>
   <br/>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-voting-voting-classifier-a-id-2-1-a-br">
     Max Voting / Voting Classifier
     <a id="2.1">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#averaging-a-id-2-2-a-br">
     Averaging
     <a id="2.2">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weighted-averaging-a-id-2-3-a-br">
     Weighted Averaging
     <a id="2.3">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#models-include">
     Models include:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#finally-to-calculate-the-average-weights-let-us-look-at-the-following-code">
       Finally to calculate the average weights let us look at the following code
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stacking-a-id-2-4-a-br">
     Stacking
     <a id="2.4">
     </a>
     <br/>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#blending-a-id-2-5-a-br">
   Blending
   <a id="2.5">
   </a>
   <br/>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bagging-a-id-2-6-a-br">
     Bagging
     <a id="2.6">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#boosting-a-id-2-7-a-br">
     2.7 Boosting
     <a id="2.7">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references-a-id-3-a-br">
     References
     <a id="3">
     </a>
     <br/>
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>11. Ensemble learning</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ensemble-techniques-a-id-2-a-br">
   Ensemble Techniques
   <a id="2">
   </a>
   <br/>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-voting-voting-classifier-a-id-2-1-a-br">
     Max Voting / Voting Classifier
     <a id="2.1">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#averaging-a-id-2-2-a-br">
     Averaging
     <a id="2.2">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weighted-averaging-a-id-2-3-a-br">
     Weighted Averaging
     <a id="2.3">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#models-include">
     Models include:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#finally-to-calculate-the-average-weights-let-us-look-at-the-following-code">
       Finally to calculate the average weights let us look at the following code
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stacking-a-id-2-4-a-br">
     Stacking
     <a id="2.4">
     </a>
     <br/>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#blending-a-id-2-5-a-br">
   Blending
   <a id="2.5">
   </a>
   <br/>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bagging-a-id-2-6-a-br">
     Bagging
     <a id="2.6">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#boosting-a-id-2-7-a-br">
     2.7 Boosting
     <a id="2.7">
     </a>
     <br/>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references-a-id-3-a-br">
     References
     <a id="3">
     </a>
     <br/>
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="ensemble-learning">
<h1>11. Ensemble learning<a class="headerlink" href="#ensemble-learning" title="Permalink to this headline">¶</a></h1>
<p>Suppose you wanted to purchase a car.Now by just visiting the first car company and based on the dealer’s advise  will we straight away make a buy on a car? Answer is defenitely a big NO right?</p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=EbYOnORvrio">Introduction to Ensemble Techniques</a>.</p></li>
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=sN5ZcJLDMaE">Introduction to Ensemble Techniques</a></p></li>
</ul>
<p><img alt="" src="https://thumbs.dreamstime.com/b/car-sale-4167169.jpg" /></p>
<p>So what we do is first decide whether which car to buy ,whether it is a new or used car ,type of car,model and year of manufacture, look for list of dealers ,look for discounts/offers ,customer reviews,opinion from friends and family, performance ,fuel efficiency and obvious any car buyer will for the best price range etc.</p>
<p><img alt="" src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSC0-mqf3xqr3MESGW-mGwaWQkkBjwJGbNFsQ&amp;usqp=CAU" /></p>
<p>In short, you wouldn’t directly reach a conclusion, but will instead make a decision considering all the above mentioned factors before we decide on the best choice.</p>
<p><strong>Ensemble models</strong> in machine learning operate on a similar idea.
<img alt="" src="https://i.pinimg.com/474x/d7/c7/9b/d7c79b0c7abc5a34e17710fe596f6834.jpg" /><br />
Ensemble Learning helps improve machine learning results by combining several models to improve predictive performance compared to a single model.
<img alt="" src="https://i.imgur.com/L2Jaqm8.png" /></p>
<div class="section" id="ensemble-techniques-a-id-2-a-br">
<h2>Ensemble Techniques <a id="2"></a> <br><a class="headerlink" href="#ensemble-techniques-a-id-2-a-br" title="Permalink to this headline">¶</a></h2>
<div class="section" id="max-voting-voting-classifier-a-id-2-1-a-br">
<h3>Max Voting / Voting Classifier <a id="2.1"></a> <br><a class="headerlink" href="#max-voting-voting-classifier-a-id-2-1-a-br" title="Permalink to this headline">¶</a></h3>
<p>The <strong>max voting</strong> method is generally used for classification problems. In this technique, multiple models are used to make predictions for each data point. The predictions by each model are considered as a ‘vote’. The predictions which we get from the majority of the models are used as the final prediction.</p>
<p>A <strong>Voting Classifier</strong> is a machine learning model that trains on an ensemble of numerous models and predicts an output (class) based on their highest probability of chosen class as the output.
It simply aggregates the findings of each classifier passed into Voting Classifier and predicts the output class based on the highest majority of voting. The idea is instead of creating separate dedicated models and finding the accuracy for each them, we create a single model which trains by these models and predicts output based on their combined majority of voting for each output class.</p>
<p>Now let us use the IRIS dataset to demonstrate the Voting Classifier</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># importing libraries </span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span> <span class="p">,</span><span class="n">BaggingClassifier</span><span class="p">,</span> <span class="n">ExtraTreesClassifier</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostClassifier</span><span class="p">,</span><span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span> 
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span><span class="n">std</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span><span class="n">RepeatedStratifiedKFold</span><span class="p">,</span><span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span><span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_wine</span><span class="p">,</span><span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectKBest</span><span class="p">,</span><span class="n">f_regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span><span class="n">BayesianRidge</span><span class="p">,</span><span class="n">ElasticNet</span><span class="p">,</span><span class="n">Lasso</span><span class="p">,</span><span class="n">SGDRegressor</span><span class="p">,</span><span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.kernel_ridge</span> <span class="kn">import</span> <span class="n">KernelRidge</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span><span class="p">,</span><span class="n">OneHotEncoder</span><span class="p">,</span><span class="n">RobustScaler</span><span class="p">,</span><span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span><span class="p">,</span><span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span><span class="n">KernelPCA</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">ExtraTreesRegressor</span><span class="p">,</span><span class="n">GradientBoostingRegressor</span><span class="p">,</span><span class="n">RandomForestRegressor</span><span class="p">,</span><span class="n">VotingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span><span class="n">KFold</span><span class="p">,</span><span class="n">GridSearchCV</span><span class="p">,</span><span class="n">RandomizedSearchCV</span><span class="p">,</span><span class="n">StratifiedKFold</span><span class="p">,</span><span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span><span class="n">clone</span><span class="p">,</span><span class="n">TransformerMixin</span><span class="p">,</span><span class="n">RegressorMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVR</span><span class="p">,</span><span class="n">SVR</span>
<span class="c1">#import xgboost </span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="c1">#Import Pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">skew</span>
<span class="kn">from</span> <span class="nn">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">seed</span> <span class="o">=</span> <span class="mi">1075</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>D:\ProgramData\Anaconda3\lib\site-packages\pandas\compat\_optional.py:138: UserWarning: Pandas requires version &#39;2.7.0&#39; or newer of &#39;numexpr&#39; (version &#39;2.6.9&#39; currently installed).
  warnings.warn(msg, UserWarning)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading iris dataset </span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span> 
<span class="n">X</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> 
<span class="n">Y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ensemble of Models </span>
<span class="n">estimator</span> <span class="o">=</span> <span class="p">[]</span> 
<span class="n">estimator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;LR&#39;</span><span class="p">,</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span> <span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span><span class="n">multi_class</span> <span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)))</span> 
<span class="n">estimator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;SVC&#39;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">gamma</span> <span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)))</span> 
<span class="n">estimator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;DTC&#39;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">()))</span> 
</pre></div>
</div>
</div>
</div>
<p><strong>Voting Classifier</strong> supports two types of votings.</p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=BlrcCpypfhU">Voting Classifier</a>.</p></li>
</ul>
<p><strong>Hard Voting:</strong> In hard voting, the predicted output class is a class with the highest majority of votes i.e the class which had the highest probability of being predicted by each of the classifiers. Suppose three classifiers predicted the output class(A, A, B), so here the majority predicted A as output. Hence A will be the final prediction.
<img alt="" src="https://image.slidesharecdn.com/7-180514114334/95/ensemble-learning-and-random-forests-12-638.jpg?cb=1527755412" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Voting Classifier with hard voting </span>
<span class="n">hard_voting</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">voting</span> <span class="o">=</span><span class="s1">&#39;hard&#39;</span><span class="p">)</span> 
<span class="n">hard_voting</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">hard_voting</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># accuracy_score metric to predict Accuracy </span>
<span class="n">score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hard Voting Score </span><span class="si">% d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">score</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hard Voting Score  1
</pre></div>
</div>
</div>
</div>
<p><strong>Soft Voting:</strong> In soft voting, the output class is the prediction based on the average of probability given to that class. Suppose given some input to three models, the prediction probability for class A = (0.30, 0.47, 0.53) and B = (0.20, 0.32, 0.40). So the average for class A is 0.4333 and B is 0.3067, the winner is clearly class A because it had the highest probability averaged by each classifier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Voting Classifier with soft voting </span>
<span class="n">soft_voting</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span> <span class="o">=</span> <span class="n">estimator</span><span class="p">,</span> <span class="n">voting</span> <span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">)</span> 
<span class="n">soft_voting</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">soft_voting</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using accuracy_score </span>
<span class="n">score</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Soft Voting Score </span><span class="si">% d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">score</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Soft Voting Score  1
</pre></div>
</div>
</div>
</div>
<p>In practical the output accuracy will be more for soft voting as it is the average probability of the all estimators combined, as for our basic iris dataset we are already overfitting, so there won’t be much difference in output.</p>
</div>
<div class="section" id="averaging-a-id-2-2-a-br">
<h3>Averaging <a id="2.2"></a> <br><a class="headerlink" href="#averaging-a-id-2-2-a-br" title="Permalink to this headline">¶</a></h3>
<p>Multiple predictions are made for each data point in averaging. In this method, we take an average of predictions from all the models and use it to make the final prediction. Averaging can be used for making predictions in regression problems or while calculating probabilities for classification problems.</p>
<p>The simplest way to develop a model averaging ensemble in Keras is to train multiple models on the same dataset then combine the predictions from each of the trained models.</p>
<p>We will use a small multi-class classification problem as the basis to demonstrate a model averaging ensemble.</p>
<p>The scikit-learn class provides the make_blobs() function that can be used to create a multi-class classification problem with the prescribed number of samples, input variables, classes, and variance of samples within a class.</p>
<p>We use this problem with 500 examples, with input variables to represent the x and y coordinates of the points and a standard deviation of 2.0 for points within each group. We will use the same random state to ensure that we always get the same 500 points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_blobs</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate 2d classification dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_blobs</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">centers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cluster_std</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># scatter plot, dots colored by class value</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">y</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;green&#39;</span><span class="p">}</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="n">group</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/11_ensemble-learning-techniques-tutorial_14_0.png" src="_images/11_ensemble-learning-techniques-tutorial_14_0.png" />
</div>
</div>
<p>We can see that the standard deviation of 2.0 means that the classes are not linearly separable (separable by a line) causing many ambiguous points.</p>
<p><strong>So in summary for every instance of test dataset, the average predictions are calculated. This method often reduces overfit and creates a smoother regression model.</strong></p>
</div>
<div class="section" id="weighted-averaging-a-id-2-3-a-br">
<h3>Weighted Averaging <a id="2.3"></a> <br><a class="headerlink" href="#weighted-averaging-a-id-2-3-a-br" title="Permalink to this headline">¶</a></h3>
<p>This is an extension of the averaging method. All models are assigned different weights defining the importance of each model for prediction.</p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=FyiPI_hxgtM">Weighted Averaging</a>.</p></li>
</ul>
<p><img alt="" src="https://www.analyticsvidhya.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-22-at-6.40.37-pm.png" /></p>
<p>For this we will use the housing prices dataset to demonstrate as shown below</p>
<p>Firstly import the libraries &amp; data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./assets/input/house-prices-advanced-regression-techniques/train.csv&#39;</span><span class="p">,</span><span class="n">na_values</span> <span class="o">=</span> <span class="s1">&#39;#NAME?&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./assets/input/house-prices-advanced-regression-techniques/test.csv&#39;</span><span class="p">,</span><span class="n">na_values</span> <span class="o">=</span> <span class="s1">&#39;#NAME?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">a6173b6d2416</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./assets/input/house-prices-advanced-regression-techniques/train.csv&#39;</span><span class="p">,</span><span class="n">na_values</span> <span class="o">=</span> <span class="s1">&#39;#NAME?&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./assets/input/house-prices-advanced-regression-techniques/test.csv&#39;</span><span class="p">,</span><span class="n">na_values</span> <span class="o">=</span> <span class="s1">&#39;#NAME?&#39;</span><span class="p">)</span>

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\util\_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\parsers\base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span>             <span class="n">memory_map</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span>             <span class="n">storage_options</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">229</span>             <span class="n">errors</span><span class="o">=</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span> 

<span class="nn">D:\ProgramData\Anaconda3\lib\site-packages\pandas\io\common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span>                 <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span>                 <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">707</span>                 <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span>         <span class="k">else</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;./assets/input/house-prices-advanced-regression-techniques/train.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Based on the distribution of data let us remove some of the outliers
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train</span><span class="p">[(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;GrLivArea&#39;</span><span class="p">]</span> <span class="o">&gt;</span><span class="mi">4000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">300000</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us concatenate both the training and test datasets into a single dataframe for ease of data cleaning and feature engineering.’Id’ feature has no significance to our modelling since it is a continuous variable ,so dropping this feature on both train and test datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">full</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">full</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2917, 80)
</pre></div>
</div>
</div>
</div>
<p>Now let us preprocess the data by doing some missing values treatment</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_values</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">missing_values</span><span class="p">[</span><span class="n">missing_values</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PoolQC          2908
MiscFeature     2812
Alley           2719
Fence           2346
SalePrice       1459
FireplaceQu     1420
LotFrontage      486
GarageCond       159
GarageYrBlt      159
GarageFinish     159
GarageQual       159
GarageType       157
BsmtExposure      82
BsmtCond          82
BsmtQual          81
BsmtFinType2      80
BsmtFinType1      79
MasVnrType        24
MasVnrArea        23
MSZoning           4
Functional         2
BsmtHalfBath       2
BsmtFullBath       2
Utilities          2
KitchenQual        1
TotalBsmtSF        1
BsmtUnfSF          1
GarageCars         1
GarageArea         1
BsmtFinSF2         1
BsmtFinSF1         1
Exterior2nd        1
Exterior1st        1
SaleType           1
Electrical         1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>let us impute the missing values of LotFrontage based on the median of LotArea and Neighborhood. To achieve this let us first group Neighborhood and LotFrontage with respect to median,mean and count.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">])[[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">LotFrontage</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>median</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Neighborhood</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Blmngtn</th>
      <td>46.900000</td>
      <td>43.0</td>
      <td>20</td>
    </tr>
    <tr>
      <th>Blueste</th>
      <td>27.300000</td>
      <td>24.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>BrDale</th>
      <td>21.500000</td>
      <td>21.0</td>
      <td>30</td>
    </tr>
    <tr>
      <th>BrkSide</th>
      <td>55.789474</td>
      <td>51.0</td>
      <td>95</td>
    </tr>
    <tr>
      <th>ClearCr</th>
      <td>88.150000</td>
      <td>80.5</td>
      <td>20</td>
    </tr>
    <tr>
      <th>CollgCr</th>
      <td>71.336364</td>
      <td>70.0</td>
      <td>220</td>
    </tr>
    <tr>
      <th>Crawfor</th>
      <td>69.951807</td>
      <td>70.0</td>
      <td>83</td>
    </tr>
    <tr>
      <th>Edwards</th>
      <td>65.153409</td>
      <td>64.5</td>
      <td>176</td>
    </tr>
    <tr>
      <th>Gilbert</th>
      <td>74.207207</td>
      <td>64.0</td>
      <td>111</td>
    </tr>
    <tr>
      <th>IDOTRR</th>
      <td>62.241379</td>
      <td>60.0</td>
      <td>87</td>
    </tr>
    <tr>
      <th>MeadowV</th>
      <td>25.606061</td>
      <td>21.0</td>
      <td>33</td>
    </tr>
    <tr>
      <th>Mitchel</th>
      <td>75.144444</td>
      <td>74.0</td>
      <td>90</td>
    </tr>
    <tr>
      <th>NAmes</th>
      <td>75.210667</td>
      <td>73.0</td>
      <td>375</td>
    </tr>
    <tr>
      <th>NPkVill</th>
      <td>28.142857</td>
      <td>24.0</td>
      <td>21</td>
    </tr>
    <tr>
      <th>NWAmes</th>
      <td>81.517647</td>
      <td>80.0</td>
      <td>85</td>
    </tr>
    <tr>
      <th>NoRidge</th>
      <td>91.629630</td>
      <td>89.0</td>
      <td>54</td>
    </tr>
    <tr>
      <th>NridgHt</th>
      <td>84.184049</td>
      <td>92.0</td>
      <td>163</td>
    </tr>
    <tr>
      <th>OldTown</th>
      <td>61.777293</td>
      <td>60.0</td>
      <td>229</td>
    </tr>
    <tr>
      <th>SWISU</th>
      <td>59.068182</td>
      <td>60.0</td>
      <td>44</td>
    </tr>
    <tr>
      <th>Sawyer</th>
      <td>74.551020</td>
      <td>72.0</td>
      <td>98</td>
    </tr>
    <tr>
      <th>SawyerW</th>
      <td>70.669811</td>
      <td>67.0</td>
      <td>106</td>
    </tr>
    <tr>
      <th>Somerst</th>
      <td>64.549383</td>
      <td>72.5</td>
      <td>162</td>
    </tr>
    <tr>
      <th>StoneBr</th>
      <td>62.173913</td>
      <td>60.0</td>
      <td>46</td>
    </tr>
    <tr>
      <th>Timber</th>
      <td>81.157895</td>
      <td>82.0</td>
      <td>57</td>
    </tr>
    <tr>
      <th>Veenker</th>
      <td>72.000000</td>
      <td>80.0</td>
      <td>16</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>LotArea is a continuous feature so it is best to use panda’s qcut method to divide it into 10 parts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;LotAreaCut&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;LotAreaCut&#39;</span><span class="p">]])[[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">LotFrontage</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>median</th>
      <th>count</th>
    </tr>
    <tr>
      <th>LotAreaCut</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(1299.999, 4921.8]</th>
      <td>35.741036</td>
      <td>34.0</td>
      <td>251</td>
    </tr>
    <tr>
      <th>(4921.8, 7007.2]</th>
      <td>55.460674</td>
      <td>52.0</td>
      <td>267</td>
    </tr>
    <tr>
      <th>(7007.2, 7949.0]</th>
      <td>62.959839</td>
      <td>62.0</td>
      <td>249</td>
    </tr>
    <tr>
      <th>(7949.0, 8740.4]</th>
      <td>67.113725</td>
      <td>65.0</td>
      <td>255</td>
    </tr>
    <tr>
      <th>(8740.4, 9452.0]</th>
      <td>69.959184</td>
      <td>70.0</td>
      <td>245</td>
    </tr>
    <tr>
      <th>(9452.0, 10148.8]</th>
      <td>73.988235</td>
      <td>75.0</td>
      <td>255</td>
    </tr>
    <tr>
      <th>(10148.8, 11000.0]</th>
      <td>73.636364</td>
      <td>75.0</td>
      <td>253</td>
    </tr>
    <tr>
      <th>(11000.0, 12196.8]</th>
      <td>83.371681</td>
      <td>82.0</td>
      <td>226</td>
    </tr>
    <tr>
      <th>(12196.8, 14285.8]</th>
      <td>84.973684</td>
      <td>85.0</td>
      <td>228</td>
    </tr>
    <tr>
      <th>(14285.8, 215245.0]</th>
      <td>92.846535</td>
      <td>90.0</td>
      <td>202</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>So let us impute the missing values of LotFrontage as stated above with the median of LotArea and Neighborhood.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;LotAreaCut&#39;</span><span class="p">,</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">])[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
<span class="n">full</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;LotAreaCut&#39;</span><span class="p">])[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us recheck the missing values to see our LotFrontage missing values are imputed successfully.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missing_values</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">missing_values</span><span class="p">[</span><span class="n">missing_values</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PoolQC          2908
MiscFeature     2812
Alley           2719
Fence           2346
SalePrice       1459
FireplaceQu     1420
GarageCond       159
GarageQual       159
GarageFinish     159
GarageYrBlt      159
GarageType       157
BsmtCond          82
BsmtExposure      82
BsmtQual          81
BsmtFinType2      80
BsmtFinType1      79
MasVnrType        24
MasVnrArea        23
MSZoning           4
Functional         2
BsmtHalfBath       2
Utilities          2
BsmtFullBath       2
KitchenQual        1
Electrical         1
TotalBsmtSF        1
BsmtUnfSF          1
GarageCars         1
GarageArea         1
BsmtFinSF2         1
BsmtFinSF1         1
Exterior2nd        1
Exterior1st        1
SaleType           1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Now let us focus on numerical features with one missing value and replace them with 0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MasVnrArea&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">,</span> <span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageCars&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span><span class="n">full</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us focus on some of the categorical features with major count of missing values and replace them with ‘None’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PoolQC&quot;</span> <span class="p">,</span> <span class="s2">&quot;MiscFeature&quot;</span><span class="p">,</span> <span class="s2">&quot;Alley&quot;</span><span class="p">,</span> <span class="s2">&quot;Fence&quot;</span><span class="p">,</span> <span class="s2">&quot;FireplaceQu&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageQual&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageCond&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageFinish&quot;</span><span class="p">,</span>
<span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">,</span> <span class="s2">&quot;GarageType&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtExposure&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtCond&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtQual&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtFinType2&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtFinType1&quot;</span><span class="p">,</span> <span class="s2">&quot;MasVnrType&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col1</span> <span class="ow">in</span> <span class="n">columns1</span><span class="p">:</span><span class="n">full</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us focus on some of the categorical features with fewer missing values and replace them with the most frequently occured value which is the mode of that feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MSZoning&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">,</span> <span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">,</span> <span class="s2">&quot;Utilities&quot;</span><span class="p">,</span> <span class="s2">&quot;Functional&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Electrical&quot;</span><span class="p">,</span> <span class="s2">&quot;KitchenQual&quot;</span><span class="p">,</span> <span class="s2">&quot;SaleType&quot;</span><span class="p">,</span><span class="s2">&quot;Exterior1st&quot;</span><span class="p">,</span> <span class="s2">&quot;Exterior2nd&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col2</span> <span class="ow">in</span> <span class="n">columns2</span><span class="p">:</span>
    <span class="n">full</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">full</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let us recheck if we have any other missing values that needs to be imputed except the SalePrice for the test dataset which is the target variable to be determined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="n">full</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SalePrice    1459
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numeric_features</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
<span class="n">numeric_features</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;MSSubClass&#39;, &#39;LotFrontage&#39;, &#39;LotArea&#39;, &#39;OverallQual&#39;, &#39;OverallCond&#39;,
       &#39;YearBuilt&#39;, &#39;YearRemodAdd&#39;, &#39;MasVnrArea&#39;, &#39;BsmtFinSF1&#39;, &#39;BsmtFinSF2&#39;,
       &#39;BsmtUnfSF&#39;, &#39;TotalBsmtSF&#39;, &#39;1stFlrSF&#39;, &#39;2ndFlrSF&#39;, &#39;LowQualFinSF&#39;,
       &#39;GrLivArea&#39;, &#39;BsmtFullBath&#39;, &#39;BsmtHalfBath&#39;, &#39;FullBath&#39;, &#39;HalfBath&#39;,
       &#39;BedroomAbvGr&#39;, &#39;KitchenAbvGr&#39;, &#39;TotRmsAbvGrd&#39;, &#39;Fireplaces&#39;,
       &#39;GarageCars&#39;, &#39;GarageArea&#39;, &#39;WoodDeckSF&#39;, &#39;OpenPorchSF&#39;,
       &#39;EnclosedPorch&#39;, &#39;3SsnPorch&#39;, &#39;ScreenPorch&#39;, &#39;PoolArea&#39;, &#39;MiscVal&#39;,
       &#39;MoSold&#39;, &#39;YrSold&#39;, &#39;SalePrice&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Numstr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MSSubClass&quot;</span><span class="p">,</span><span class="s2">&quot;BsmtFullBath&quot;</span><span class="p">,</span><span class="s2">&quot;BsmtHalfBath&quot;</span><span class="p">,</span><span class="s2">&quot;HalfBath&quot;</span><span class="p">,</span><span class="s2">&quot;BedroomAbvGr&quot;</span><span class="p">,</span><span class="s2">&quot;KitchenAbvGr&quot;</span><span class="p">,</span><span class="s2">&quot;MoSold&quot;</span><span class="p">,</span>
          <span class="s2">&quot;YrSold&quot;</span><span class="p">,</span><span class="s2">&quot;YearBuilt&quot;</span><span class="p">,</span><span class="s2">&quot;YearRemodAdd&quot;</span><span class="p">,</span><span class="s2">&quot;LowQualFinSF&quot;</span><span class="p">,</span><span class="s2">&quot;GarageYrBlt&quot;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Numstr</span><span class="p">:</span>
    <span class="n">full</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;MSSubClass&#39;</span><span class="p">])[[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">SalePrice</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>median</th>
      <th>count</th>
    </tr>
    <tr>
      <th>MSSubClass</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>120</th>
      <td>200779.080460</td>
      <td>192000.0</td>
      <td>87</td>
    </tr>
    <tr>
      <th>150</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>160</th>
      <td>138647.380952</td>
      <td>146000.0</td>
      <td>63</td>
    </tr>
    <tr>
      <th>180</th>
      <td>102300.000000</td>
      <td>88500.0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>190</th>
      <td>129613.333333</td>
      <td>128250.0</td>
      <td>30</td>
    </tr>
    <tr>
      <th>20</th>
      <td>185224.811567</td>
      <td>159250.0</td>
      <td>536</td>
    </tr>
    <tr>
      <th>30</th>
      <td>95829.724638</td>
      <td>99900.0</td>
      <td>69</td>
    </tr>
    <tr>
      <th>40</th>
      <td>156125.000000</td>
      <td>142500.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>45</th>
      <td>108591.666667</td>
      <td>107500.0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>50</th>
      <td>143302.972222</td>
      <td>132000.0</td>
      <td>144</td>
    </tr>
    <tr>
      <th>60</th>
      <td>240403.542088</td>
      <td>216000.0</td>
      <td>297</td>
    </tr>
    <tr>
      <th>70</th>
      <td>166772.416667</td>
      <td>156000.0</td>
      <td>60</td>
    </tr>
    <tr>
      <th>75</th>
      <td>192437.500000</td>
      <td>163500.0</td>
      <td>16</td>
    </tr>
    <tr>
      <th>80</th>
      <td>169736.551724</td>
      <td>166500.0</td>
      <td>58</td>
    </tr>
    <tr>
      <th>85</th>
      <td>147810.000000</td>
      <td>140750.0</td>
      <td>20</td>
    </tr>
    <tr>
      <th>90</th>
      <td>133541.076923</td>
      <td>135980.0</td>
      <td>52</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">map_values</span><span class="p">():</span>
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oMSSubClass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">MSSubClass</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;180&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> 
                                        <span class="s1">&#39;30&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;45&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> 
                                        <span class="s1">&#39;190&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;90&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> 
                                        <span class="s1">&#39;85&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;40&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;160&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> 
                                        <span class="s1">&#39;70&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;75&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;80&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;150&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                                        <span class="s1">&#39;120&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oMSZoning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">MSZoning</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;C (all)&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;RM&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;FV&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oNeighborhood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Neighborhood</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;MeadowV&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="s1">&#39;IDOTRR&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;BrDale&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                                               <span class="s1">&#39;OldTown&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Edwards&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;BrkSide&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                               <span class="s1">&#39;Sawyer&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Blueste&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;SWISU&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;NAmes&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                                               <span class="s1">&#39;NPkVill&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Mitchel&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                                               <span class="s1">&#39;SawyerW&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Gilbert&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;NWAmes&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
                                               <span class="s1">&#39;Blmngtn&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;CollgCr&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;ClearCr&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;Crawfor&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span>
                                               <span class="s1">&#39;Veenker&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Somerst&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Timber&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                                               <span class="s1">&#39;StoneBr&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span>
                                               <span class="s1">&#39;NoRidge&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;NridgHt&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oCondition1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Condition1</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Artery&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;Feedr&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;RRAe&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                                           <span class="s1">&#39;Norm&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;RRAn&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="s1">&#39;PosN&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;RRNe&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                                           <span class="s1">&#39;PosA&#39;</span><span class="p">:</span><span class="mi">5</span> <span class="p">,</span><span class="s1">&#39;RRNn&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oBldgType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">BldgType</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;2fmCon&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Duplex&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Twnhs&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;1Fam&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;TwnhsE&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oHouseStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">HouseStyle</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;1.5Unf&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> 
                                           <span class="s1">&#39;1.5Fin&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;2.5Unf&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SFoyer&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> 
                                           <span class="s1">&#39;1Story&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;SLvl&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="s1">&#39;2Story&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;2.5Fin&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oExterior1st&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Exterior1st</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;BrkComm&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                             <span class="s1">&#39;AsphShn&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;CBlock&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;AsbShng&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                                             <span class="s1">&#39;WdShing&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Wd Sdng&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;MetalSd&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Stucco&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;HdBoard&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                             <span class="s1">&#39;BrkFace&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Plywood&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                                             <span class="s1">&#39;VinylSd&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                                             <span class="s1">&#39;CemntBd&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
                                             <span class="s1">&#39;Stone&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;ImStucc&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oMasVnrType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">MasVnrType</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;BrkCmn&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;BrkFace&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Stone&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oExterQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">ExterQual</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Fa&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oFoundation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Foundation</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Slab&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> 
                                           <span class="s1">&#39;BrkTil&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;CBlock&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Stone&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                                           <span class="s1">&#39;Wood&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;PConc&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oBsmtQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">BsmtQual</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Fa&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oBsmtExposure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">BsmtExposure</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Av&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oHeating&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Heating</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Floor&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Grav&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Wall&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;OthW&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;GasW&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;GasA&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oHeatingQC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">HeatingQC</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Po&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fa&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oKitchenQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">KitchenQual</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Fa&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oFunctional&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">Functional</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;Maj2&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Maj1&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Min1&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Min2&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Mod&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sev&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Typ&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oFireplaceQu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">FireplaceQu</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Po&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fa&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;TA&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Gd&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oGarageType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">GarageType</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;CarPort&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;Detchd&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                                           <span class="s1">&#39;2Types&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Basment&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                                           <span class="s1">&#39;Attchd&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;BuiltIn&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oGarageFinish&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">GarageFinish</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;None&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Unf&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;RFn&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Fin&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oPavedDrive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">PavedDrive</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oSaleType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">SaleType</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;COD&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ConLD&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ConLI&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ConLw&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Oth&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;WD&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="s1">&#39;CWD&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Con&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;New&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
    
    <span class="n">full</span><span class="p">[</span><span class="s2">&quot;oSaleCondition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">SaleCondition</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s1">&#39;AdjLand&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Abnorml&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Alloca&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Family&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Normal&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Partial&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">})</span>            
                
                        
                        
    
    <span class="k">return</span> <span class="s2">&quot;Done!&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">map_values</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Done!&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop two unwanted columns</span>
<span class="n">full</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;LotAreaCut&quot;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">full</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full</span><span class="p">[[</span><span class="s1">&#39;YearBuilt&#39;</span><span class="p">,</span><span class="s1">&#39;YearRemodAdd&#39;</span><span class="p">,</span><span class="s1">&#39;GarageYrBlt&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>YearBuilt</th>
      <th>YearRemodAdd</th>
      <th>GarageYrBlt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2003</td>
      <td>2003</td>
      <td>2003.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1976</td>
      <td>1976</td>
      <td>1976.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2001</td>
      <td>2002</td>
      <td>2001.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915</td>
      <td>1970</td>
      <td>1998.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2000</td>
      <td>2000</td>
      <td>2000.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let us create a class for the LabelEncoder to fit and transform some of the identified features</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">labenc</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span><span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">&#39;YearBuilt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;YearBuilt&#39;</span><span class="p">])</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">&#39;YearRemodAdd&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;YearRemodAdd&#39;</span><span class="p">])</span>
        <span class="n">X</span><span class="p">[</span><span class="s1">&#39;GarageYrBlt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">label</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;GarageYrBlt&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">X</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">skewness</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span><span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">skew</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skew</span> <span class="o">=</span> <span class="n">skew</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X_numeric</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="n">X_numeric</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">skewness_features</span> <span class="o">=</span> <span class="n">skewness</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">skewness</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skew</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">X</span><span class="p">[</span><span class="n">skewness_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">skewness_features</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">dummies</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span><span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<p>Now we will use pipeline to chain multiple estimators into one. This is useful as there is often a fixed sequence of steps in processing the data, for example feature selection, normalization and classification. Pipeline serves two purposes here:</p>
<p>Convenience: You only have to call fit and predict once on your data to fit a whole sequence of estimators.
Joint parameter selection: You can grid search over parameters of all estimators in the pipeline at once.
All estimators in a pipeline, except the last one, must be transformers (i.e. must have a transform method). The last estimator may be any type (transformer, classifier, etc.).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;labenc&#39;</span><span class="p">,</span><span class="n">labenc</span><span class="p">()),(</span><span class="s1">&#39;skewness&#39;</span><span class="p">,</span><span class="n">skewness</span><span class="p">(</span><span class="n">skew</span> <span class="o">=</span><span class="mi">1</span><span class="p">)),(</span><span class="s1">&#39;dummies&#39;</span><span class="p">,</span><span class="n">dummies</span><span class="p">())])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_copy</span> <span class="o">=</span> <span class="n">full</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">full_copy</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">robust_scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1458
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">=</span> <span class="n">data_pipeline</span><span class="p">[:</span><span class="n">n_train</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span>
<span class="n">test_X</span> <span class="o">=</span> <span class="n">data_pipeline</span><span class="p">[</span><span class="n">n_train</span><span class="p">:]</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">test_X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((1458, 405), (1458,), (1459, 405))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaled</span> <span class="o">=</span> <span class="n">robust_scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">y_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">)</span>
<span class="n">test_X_scaled</span> <span class="o">=</span> <span class="n">robust_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y_log</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">test_X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((1458, 405), (1458,), (1459, 405))
</pre></div>
</div>
</div>
</div>
<p>Now we will perform some feature selection like Lasso</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">add_feature</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">additional</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional</span> <span class="o">=</span> <span class="n">additional</span>
    
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span>   
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span>   
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span>
            
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_TotalHouse_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_GrLivArea_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;GrLivArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oMSZoning_TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oMSZoning&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oMSZoning_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oMSZoning&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oMSZoning_YearBuilt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oMSZoning&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;YearBuilt&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oNeighborhood_TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oNeighborhood&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oNeighborhood_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oNeighborhood&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_oNeighborhood_YearBuilt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oNeighborhood&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;YearBuilt&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;+_BsmtFinSF1_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_oFunctional_TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oFunctional&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_oFunctional_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oFunctional&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_LotArea_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_TotalHouse_LotArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;LotArea&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_oCondition1_TotalHouse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oCondition1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalHouse&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;-_oCondition1_OverallQual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;oCondition1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OverallQual&quot;</span><span class="p">]</span>
            
           
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;Bsmt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;BsmtFinSF1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;BsmtFinSF2&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;BsmtUnfSF&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;Rooms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;FullBath&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotRmsAbvGrd&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;PorchArea&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;3SsnPorch&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;ScreenPorch&quot;</span><span class="p">]</span>
            <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalPlace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;TotalBsmtSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;1stFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;2ndFlrSF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;GarageArea&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;OpenPorchSF&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;EnclosedPorch&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;3SsnPorch&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">X</span><span class="p">[</span><span class="s2">&quot;ScreenPorch&quot;</span><span class="p">]</span>

    
            <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s1">&#39;labenc&#39;</span><span class="p">,</span><span class="n">labenc</span><span class="p">()),(</span><span class="s1">&#39;add_feature&#39;</span><span class="p">,</span> <span class="n">add_feature</span><span class="p">(</span><span class="n">additional</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span>
                     <span class="p">(</span><span class="s1">&#39;skewness&#39;</span><span class="p">,</span><span class="n">skewness</span><span class="p">(</span><span class="n">skew</span> <span class="o">=</span><span class="mi">1</span><span class="p">)),(</span><span class="s1">&#39;dummies&#39;</span><span class="p">,</span><span class="n">dummies</span><span class="p">())])</span>

<span class="n">full_pipe</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">full</span><span class="p">)</span>
<span class="n">full_pipe</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2917, 426)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_train</span><span class="o">=</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">full_pipe</span><span class="p">[:</span><span class="n">n_train</span><span class="p">]</span>
<span class="n">test_X</span> <span class="o">=</span> <span class="n">full_pipe</span><span class="p">[</span><span class="n">n_train</span><span class="p">:]</span>
<span class="n">y</span><span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span>

<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">robust_scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">y_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">)</span>
<span class="n">test_X_scaled</span> <span class="o">=</span> <span class="n">robust_scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_scaled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1458, 426)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let us define Root Mean Square Error </span>
<span class="k">def</span> <span class="nf">rmse_cv</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;neg_mean_squared_error&quot;</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rmse</span>
</pre></div>
</div>
</div>
</div>
<p>We choose 4 models and use 5-folds cross-calidation to evaluate these models.</p>
</div>
<div class="section" id="models-include">
<h3>Models include:<a class="headerlink" href="#models-include" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>LinearRegression</p></li>
<li><p>Ridge</p></li>
<li><p>Lasso</p></li>
<li><p>Random Forest</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">LinearRegression</span><span class="p">(),</span>
             <span class="n">Ridge</span><span class="p">(),</span>
             <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
             <span class="n">RandomForestRegressor</span><span class="p">(),</span>
             <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
             <span class="n">SVR</span><span class="p">(),</span>
             <span class="n">LinearSVR</span><span class="p">(),</span>
             <span class="n">ElasticNet</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
             <span class="n">SGDRegressor</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">),</span>
             <span class="n">BayesianRidge</span><span class="p">(),</span>
             <span class="n">KernelRidge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span><span class="n">degree</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">coef0</span><span class="o">=</span><span class="mf">2.5</span><span class="p">),</span>
             <span class="n">ExtraTreesRegressor</span><span class="p">(),</span>
             <span class="n">XGBRegressor</span><span class="p">()</span>
             <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LR&#39;</span><span class="p">,</span><span class="s1">&#39;Ridge&#39;</span><span class="p">,</span><span class="s1">&#39;Lasso&#39;</span><span class="p">,</span><span class="s1">&#39;RF&#39;</span><span class="p">,</span><span class="s1">&#39;GBR&#39;</span><span class="p">,</span><span class="s1">&#39;SVR&#39;</span><span class="p">,</span><span class="s1">&#39;LSVR&#39;</span><span class="p">,</span><span class="s1">&#39;ENet&#39;</span><span class="p">,</span><span class="s1">&#39;SGDR&#39;</span><span class="p">,</span><span class="s1">&#39;BayRidge&#39;</span><span class="p">,</span><span class="s1">&#39;Kernel&#39;</span><span class="p">,</span><span class="s1">&#39;XTreeR&#39;</span><span class="p">,</span><span class="s1">&#39;XGBR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span><span class="n">names</span><span class="p">):</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">rmse_cv</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X_scaled</span><span class="p">,</span><span class="n">y_log</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{:.6f}</span><span class="s2">, </span><span class="si">{:4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">score</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LR: 589390151.573230, 398582213.927010
Ridge: 0.117596, 0.009054
Lasso: 0.120932, 0.005813
RF: 0.135801, 0.008027
GBR: 0.121079, 0.004481
SVR: 0.112700, 0.004770
LSVR: 0.128588, 0.010654
ENet: 0.108729, 0.005422
SGDR: 0.292973, 0.010462
BayRidge: 0.110577, 0.005997
Kernel: 0.109421, 0.005545
XTreeR: 0.134726, 0.008523
XGBR: 0.129406, 0.007979
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To define the average weight </span>
<span class="k">class</span> <span class="nc">AverageWeight</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models_</span> <span class="o">=</span> <span class="p">[</span><span class="n">clone</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models_</span><span class="p">])</span>
        <span class="c1"># for every data point, single model prediction times weight, then add them together</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">single</span> <span class="o">=</span> <span class="p">[</span><span class="n">pred</span><span class="p">[</span><span class="n">model</span><span class="p">,</span><span class="n">data</span><span class="p">]</span><span class="o">*</span><span class="n">weight</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span><span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)]</span>
            <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">single</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">w</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.0004</span><span class="p">,</span> <span class="n">kernel</span> <span class="o">=</span> <span class="s1">&#39;rbf&#39;</span><span class="p">)</span>
<span class="n">ker</span> <span class="o">=</span> <span class="n">KernelRidge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span> <span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span> <span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">ela</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.0065</span><span class="p">,</span><span class="n">l1_ratio</span><span class="o">=</span><span class="mf">0.075</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">bay</span> <span class="o">=</span> <span class="n">BayesianRidge</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finally-to-calculate-the-average-weights-let-us-look-at-the-following-code">
<h4>Finally to calculate the average weights let us look at the following code<a class="headerlink" href="#finally-to-calculate-the-average-weights-let-us-look-at-the-following-code" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign weights to all the above 6 models</span>
<span class="n">w1</span> <span class="o">=</span> <span class="mf">0.047</span>
<span class="n">w2</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">w3</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">w4</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">w5</span> <span class="o">=</span> <span class="mf">0.003</span>
<span class="n">w6</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">weight_avg</span> <span class="o">=</span> <span class="n">AverageWeight</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">lasso</span><span class="p">,</span><span class="n">ridge</span><span class="p">,</span><span class="n">svr</span><span class="p">,</span><span class="n">ker</span><span class="p">,</span><span class="n">ela</span><span class="p">,</span><span class="n">bay</span><span class="p">],</span><span class="n">weight</span><span class="o">=</span><span class="p">[</span><span class="n">w1</span><span class="p">,</span><span class="n">w2</span><span class="p">,</span><span class="n">w3</span><span class="p">,</span><span class="n">w4</span><span class="p">,</span><span class="n">w5</span><span class="p">,</span><span class="n">w6</span><span class="p">])</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">rmse_cv</span><span class="p">(</span><span class="n">weight_avg</span><span class="p">,</span><span class="n">X_scaled</span><span class="p">,</span><span class="n">y_log</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10924395327091971
</pre></div>
</div>
</div>
</div>
<p>If we consider only two models then the score will vary</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight_avg</span> <span class="o">=</span> <span class="n">AverageWeight</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">svr</span><span class="p">,</span><span class="n">ker</span><span class="p">],</span><span class="n">weight</span><span class="o">=</span><span class="p">[</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.50</span><span class="p">])</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">rmse_cv</span><span class="p">(</span><span class="n">weight_avg</span><span class="p">,</span><span class="n">X_scaled</span><span class="p">,</span><span class="n">y_log</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.11166439558199073
</pre></div>
</div>
</div>
</div>
<p>So in summary Weighted averaging is a slightly modified version of simple averaging, where the prediction of each model is multiplied by the weight and then their average is calculated.</p>
</div>
</div>
<div class="section" id="stacking-a-id-2-4-a-br">
<h3>Stacking <a id="2.4"></a> <br><a class="headerlink" href="#stacking-a-id-2-4-a-br" title="Permalink to this headline">¶</a></h3>
<p><img alt="" src="https://d1m75rqqgidzqn.cloudfront.net/wp-data/2020/05/21160015/shutterstock_1159836664-696x464.jpg" />
Stacking is an ensemble learning technique that uses predictions from multiple models (for example decision tree, knn or svm) to build a new model. This model is used for making predictions on the test set.</p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=DCrcoh7cMHU">Stacking</a>.</p></li>
</ul>
<p>Stacking, also known as Stacked Generalization is an ensemble technique that combines multiple classifications or regression models via a meta-classifier or a meta-regressor. The base-level models are trained on a complete training set, then the meta-model is trained on the features that are outputs of the base-level model. The base-level often consists of different learning algorithms and therefore stacking ensembles are often heterogeneous. Here is a diagram illustrating the process</p>
<p>Below is a step-wise explanation for a simple stacked ensemble:</p>
<p><img alt="" src="https://www.researchgate.net/publication/324552457/figure/fig3/AS:616245728645121&#64;1523935839872/An-example-scheme-of-stacking-ensemble-learning.png" /></p>
<p>Step 1:The train set is split into 10 parts.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-11-300x217.png" />
Step 2:A base model (suppose a decision tree) is fitted on 9 parts and predictions are made for the 10th part. This is done for each part of the train set.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-10-300x249.png" />
Step 3:The base model (in this case, decision tree) is then fitted on the whole train dataset.</p>
<p>Step 4:Using this model, predictions are made on the test set.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-2-300x225.png" />
Step 5:Steps 2 to 4 are repeated for another base model (say knn) resulting in another set of predictions for the train set and test set.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-3-300x224.png" />
Step 6:The predictions from the train set are used as features to build a new model.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image12-292x300.png" /></p>
<p>Step 7:This model is used to make final predictions on the test prediction set.</p>
<p>In order to simplify the above explanation, the stacking model we have created has only two levels. The decision tree and knn models are built at level zero, while a logistic regression model is built at level one. Feel free to create multiple levels in a stacking model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">stacking</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">RegressorMixin</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mod</span><span class="p">,</span><span class="n">meta_model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mod</span> <span class="o">=</span> <span class="n">mod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_model</span> <span class="o">=</span> <span class="n">meta_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_model</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">]</span>
        <span class="n">oof_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">)))</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">train_index</span><span class="p">,</span> <span class="n">val_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
                <span class="n">renew_model</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">renew_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saved_model</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">renew_model</span><span class="p">)</span>
                <span class="n">oof_train</span><span class="p">[</span><span class="n">val_index</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">renew_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">val_index</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">oof_train</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">):</span>
        <span class="n">whole_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">single_model</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
                                      <span class="k">for</span> <span class="n">single_model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_model</span><span class="p">])</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">whole_test</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_oof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_X</span><span class="p">):</span>
        <span class="n">oof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">)))</span>
        <span class="n">test_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">test_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">test_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">test_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span><span class="n">val_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">clone_model</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="n">clone_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">train_index</span><span class="p">])</span>
                <span class="n">oof</span><span class="p">[</span><span class="n">val_index</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">val_index</span><span class="p">])</span>
                <span class="n">test_single</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">clone_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_X</span><span class="p">)</span>
            <span class="n">test_mean</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_single</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">oof</span><span class="p">,</span> <span class="n">test_mean</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_scaled_imputed</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
<span class="n">y_log_imputed</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y_log</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stack_model</span> <span class="o">=</span> <span class="n">stacking</span><span class="p">(</span><span class="n">mod</span><span class="o">=</span><span class="p">[</span><span class="n">lasso</span><span class="p">,</span><span class="n">ridge</span><span class="p">,</span><span class="n">svr</span><span class="p">,</span><span class="n">ker</span><span class="p">,</span><span class="n">ela</span><span class="p">,</span><span class="n">bay</span><span class="p">],</span><span class="n">meta_model</span><span class="o">=</span><span class="n">ker</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">score</span> <span class="o">=</span> <span class="n">rmse_cv</span><span class="p">(</span><span class="n">stack_model</span><span class="p">,</span><span class="n">X_scaled_imputed</span><span class="p">,</span><span class="n">y_log_imputed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.10770374674890108
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="blending-a-id-2-5-a-br">
<h2>Blending <a id="2.5"></a> <br><a class="headerlink" href="#blending-a-id-2-5-a-br" title="Permalink to this headline">¶</a></h2>
<p>Blending follows the same approach as stacking but uses only a holdout (validation) set from the train set to make predictions. In other words, unlike stacking, the predictions are made on the holdout set only. The holdout set and the predictions are used to build a model which is run on the test set. Here is a detailed explanation of the blending process:</p>
<p>Step 1: The train set is split into training and validation sets
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-7-300x226.png" /></p>
<p>Step 2: Model(s) are fitted on the training set.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image-5-300x228.png" /></p>
<p>Step 3: The predictions are made on the validation set and the test set.</p>
<p>Step 4: The validation set and its predictions are used as features to build a new model.</p>
<p>Step 5: This model is used to make final predictions on the test and meta-features.</p>
<p>The difference between stacking and blending is that Stacking uses out-of-fold predictions for the train set of the next layer (i.e meta-model), and Blending uses a validation set (let’s say, 10-15% of the training set) to train the next layer.</p>
<p>We’ll build two models, decision tree and knn, on the train set in order to make predictions on the validation set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_wine</span>
<span class="c1"># define dataset</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_val</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">x_test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model1</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>
<span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">val_pred1</span><span class="o">=</span><span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">test_pred1</span><span class="o">=</span><span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">val_pred1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">val_pred1</span><span class="p">)</span>
<span class="n">test_pred1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_pred1</span><span class="p">)</span>

<span class="n">model2</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">val_pred2</span><span class="o">=</span><span class="n">model2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">test_pred2</span><span class="o">=</span><span class="n">model2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">val_pred2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">val_pred2</span><span class="p">)</span>
<span class="n">test_pred2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_pred2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Combining the meta-features and the validation set, a logistic regression model is built to make predictions on the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_val</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x_val</span><span class="p">,</span> <span class="n">val_pred1</span><span class="p">,</span><span class="n">val_pred2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_test</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x_test</span><span class="p">,</span> <span class="n">test_pred1</span><span class="p">,</span><span class="n">test_pred2</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df_val</span><span class="p">,</span><span class="n">y_val</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9166666666666666
</pre></div>
</div>
</div>
</div>
<div class="section" id="bagging-a-id-2-6-a-br">
<h3>Bagging <a id="2.6"></a> <br><a class="headerlink" href="#bagging-a-id-2-6-a-br" title="Permalink to this headline">¶</a></h3>
<p><img alt="" src="https://miro.medium.com/max/700/1*DFHUbdz6EyOuMYP4pDnFlw.jpeg" /></p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=Xz0x-8-cgaQ">bootstrapping</a>.</p></li>
</ul>
<p><strong>Bagging</strong>, is shorthand for the combination of bootstrapping and aggregating. Bootstrapping is a method to help decrease the variance of the classifier and reduce overfitting, by resampling data from the training set with the same cardinality as the original set. The model created should be less overfitted than a single individual model.</p>
<p>A high variance for a model is not good, suggesting its performance is sensitive to the training data provided. So, even if more the training data is provided, the model may still perform poorly. And, may not even reduce the variance of our model.</p>
<p>Bagging is an effective method when you have limited data, and by using samples you’re able to get an estimate by aggregating the scores over many samples.</p>
<p>The simplest approach with bagging is to use a couple of small subsamples and bag them, if the ensemble accuracy is much higher than the base models, it’s working; if not, use larger subsamples.Using larger subsamples is not guaranteed to improve your results. In bagging there is a tradeoff between base model accuracy and the gain you get through bagging. The aggregation from bagging may improve the ensemble greatly when you have an unstable model, yet when your base models are more stable — been trained on larger subsamples with higher accuracy — improvements from bagging reduces.</p>
<p>Once the bagging is done, and all the models have been created on (mostly) different data, a weighted average is then used to determine the final score.</p>
<p><img alt="" src="https://miro.medium.com/max/866/1*JksRZ1E72Rsx2s8lQbNR1w.jpeg" /></p>
<p>There are three main terms describing the ensemble (combination) of various models into one more effective model:</p>
<ul class="simple">
<li><p><strong>Bagging</strong> to decrease the model’s variance;</p></li>
<li><p><strong>Boosting</strong> to decreasing the model’s bias, and;</p></li>
<li><p><strong>Stacking</strong> to increasing the predictive force of the classifier.</p></li>
</ul>
<p>The idea behind bagging is combining the results of multiple models (for instance, all decision trees) to get a generalized result. Here’s a question: If you create all the models on the same set of data and combine it, will it be useful? There is a high chance that these models will give the same result since they are getting the same input. So how can we solve this problem? One of the techniques is bootstrapping.</p>
<p>Bootstrapping is a sampling technique in which we create subsets of observations from the original dataset, with replacement. The size of the subsets is the same as the size of the original set.</p>
<p>Bagging (or Bootstrap Aggregating) technique uses these subsets (bags) to get a fair idea of the distribution (complete set). The size of subsets created for bagging may be less than the original set.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/image20-768x289.png" /></p>
<p>Step 1: Multiple subsets are created from the original dataset, selecting observations with replacement.</p>
<p>Step 2: A base model (weak model) is created on each of these subsets.</p>
<p>Step 3: The models run in parallel and are independent of each other.</p>
<p>Step 4: The final predictions are determined by combining the predictions from all the models.
<img alt="" src="https://cdn.analyticsvidhya.com/wp-content/uploads/2018/05/Screenshot-from-2018-05-08-13-11-49-768x580.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_wine</span>
<span class="c1"># define dataset</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create classifiers</span>
<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">et</span> <span class="o">=</span> <span class="n">ExtraTreesClassifier</span><span class="p">()</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">()</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<span class="n">rg</span> <span class="o">=</span> <span class="n">RidgeClassifier</span><span class="p">()</span>
<span class="n">clf_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">knn</span><span class="p">,</span> <span class="n">svc</span><span class="p">,</span> <span class="n">rg</span><span class="p">]</span>
<span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">clf_array</span><span class="p">:</span>
    <span class="n">vanilla_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bagging_clf</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span><span class="n">max_samples</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">bagging_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">bagging_clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Mean of: </span><span class="si">{1:.3f}</span><span class="s2">, std: (+/-) </span><span class="si">{2:.3f}</span><span class="s2"> [</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">vanilla_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">vanilla_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Mean of: </span><span class="si">{1:.3f}</span><span class="s2">, std: (+/-) </span><span class="si">{2:.3f}</span><span class="s2"> [Bagging </span><span class="si">{0}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">bagging_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">bagging_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean of: 0.983, std: (+/-) 0.036 [RandomForestClassifier]
Mean of: 0.967, std: (+/-) 0.036 [Bagging RandomForestClassifier]

Mean of: 0.973, std: (+/-) 0.044 [ExtraTreesClassifier]
Mean of: 0.978, std: (+/-) 0.037 [Bagging ExtraTreesClassifier]

Mean of: 0.676, std: (+/-) 0.084 [KNeighborsClassifier]
Mean of: 0.759, std: (+/-) 0.059 [Bagging KNeighborsClassifier]

Mean of: 0.439, std: (+/-) 0.050 [SVC]
Mean of: 0.417, std: (+/-) 0.039 [Bagging SVC]

Mean of: 0.984, std: (+/-) 0.025 [RidgeClassifier]
Mean of: 0.978, std: (+/-) 0.037 [Bagging RidgeClassifier]
</pre></div>
</div>
</div>
</div>
<p>In all but one of the classifiers, we had lower variance as shown above . As well, the accuracy of classifiers all increased except for SVC. Looks like this bagging thing actually works.</p>
<p>So our bagged individual classifiers are (mostly) better, but which one do we choose?</p>
<p><strong>Let’s Vote!</strong></p>
<p>Sklearn’s <strong>VotingClassifier</strong> allows you to combine different machine learning classifiers, and perform a vote on what the predicted class label(s) are for a record.</p>
<p>There are two types of voting you can do for classifiers: hard and soft.</p>
<p>With hard voting, you just need a majority of classifiers to determine what the result could be. As with the image below, the various bagged models are shown with H, and the results of the classifiers are shown on the rows. On the far right, H1 and H3 vote for the first record to be “no” (purple) while H2 votes for “yes” (yellow). Because 2 of the models vote for “no”, the ensemble classifies that record as a “no”.</p>
<p>With soft (weighted), we compute a percentage weight with each classifier. A predicted class probability from each model for each record is collected and multiplied by the classifier weight, and finally averaged. The final class label is then derived from the class label with the highest average probability.</p>
<p>In reality weights are hard to find if you’re just providing your best guesses to which model you think should be weighted more or less. To counter this subjective process, a linear optimization equation or neural net could be constructed to find the correct weighting for each of the models to optimize the accuracy of the ensemble.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>
<span class="n">clf</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">knn</span><span class="p">,</span> <span class="n">svc</span><span class="p">,</span> <span class="n">rg</span><span class="p">]</span>
<span class="n">eclf</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Random Forests&#39;</span><span class="p">,</span> <span class="n">rf</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Extra Trees&#39;</span><span class="p">,</span> <span class="n">et</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;KNeighbors&#39;</span><span class="p">,</span> <span class="n">knn</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;SVC&#39;</span><span class="p">,</span> <span class="n">svc</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Ridge Classifier&#39;</span><span class="p">,</span> <span class="n">rg</span><span class="p">)],</span> <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;hard&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">rf</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">knn</span><span class="p">,</span> <span class="n">svc</span><span class="p">,</span> <span class="n">rg</span><span class="p">,</span> <span class="n">eclf</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;Extra Trees&#39;</span><span class="p">,</span> <span class="s1">&#39;KNeighbors&#39;</span><span class="p">,</span> <span class="s1">&#39;SVC&#39;</span><span class="p">,</span> <span class="s1">&#39;Ridge Classifier&#39;</span><span class="p">,</span> <span class="s1">&#39;Ensemble&#39;</span><span class="p">]):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">) [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">label</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.96 (+/- 0.06) [Random Forest]
Accuracy: 0.96 (+/- 0.06) [Extra Trees]
Accuracy: 0.68 (+/- 0.08) [KNeighbors]
Accuracy: 0.44 (+/- 0.05) [SVC]
Accuracy: 0.98 (+/- 0.03) [Ridge Classifier]
Accuracy: 0.97 (+/- 0.03) [Ensemble]
</pre></div>
</div>
</div>
</div>
<p>With our bagged ensemble results shown above, we have an increase in accuracy and a decrease in variance, so our ensemble model is working as expected after we’ve combined all the various models into one.</p>
<p>Now that we know how well our model(s) are doing individually and together, does that actually look.</p>
</div>
<div class="section" id="boosting-a-id-2-7-a-br">
<h3>2.7 Boosting <a id="2.7"></a> <br><a class="headerlink" href="#boosting-a-id-2-7-a-br" title="Permalink to this headline">¶</a></h3>
<p><img alt="" src="https://miro.medium.com/max/2936/1*jbncjeM4CfpobEnDO0ZTjw.png" /></p>
<ul class="simple">
<li><p>Video <a class="reference external" href="https://www.youtube.com/watch?v=tjy0yL1rRRU">bootstrapping</a>.</p></li>
</ul>
<p>The main idea of boosting is to add additional models to the overall ensemble model sequentially. Previously with bagging, we averaged each individual model created. This time with each iteration of boosting, a new model is created and the new base-learner model is trained (updated) from the errors of the previous learners.</p>
<p>The algorithm creates multiple weak models whose output is added together to get an overall prediction. This is ensemble modelling from earlier. The now boosted gradient shifts the current prediction nudging it to the true target, in a similar fashion to how gradient descent moves toward the true values. The gradient descent optimization occurs on the output of the varies models, and not their individual parameters.</p>
<p>There are different methods to optimize boosting algorithms.
Unlike the bagging examples above, classical boosting the subset creation is not random and performance will depend upon the performance of previous models. As, each new subset which is iterated upon contains elements which could have been misclassified by previous models. We will also be using the same hard voting we used previously to ensemble the models together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_wine</span>
<span class="c1"># define dataset</span>
<span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">load_wine</span><span class="p">()</span><span class="o">.</span><span class="n">target</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Adaptive boosting</strong> or <strong>AdaBoost</strong> is one of the simplest boosting algorithms. Usually, decision trees are used for modelling. Multiple sequential models are created, each correcting the errors from the last model. AdaBoost assigns weights to the observations which are incorrectly predicted and the subsequent model works to predict these values correctly.</p>
<p>Below are the steps for performing the AdaBoost algorithm:</p>
<ul class="simple">
<li><p>Initially, all observations in the dataset are given equal weights.</p></li>
<li><p>A model is built on a subset of data.</p></li>
<li><p>Using this model, predictions are made on the whole dataset.</p></li>
<li><p>Errors are calculated by comparing the predictions and actual values.</p></li>
<li><p>While creating the next model, higher weights are given to the data points which were predicted incorrectly.</p></li>
<li><p>Weights can be determined using the error value. For instance, higher the error more is the weight assigned to the observation.</p></li>
<li><p>This process is repeated until the error function does not change, or the maximum limit of the number of estimators is reached.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ada_boost</span> <span class="o">=</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ada_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">ada_boost</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8333333333333334
</pre></div>
</div>
</div>
</div>
<p><strong>Parameters</strong></p>
<p><strong>base_estimators</strong>:</p>
<ul class="simple">
<li><p>It helps to specify the type of base estimator, that is, the machine learning algorithm to be used as base learner.</p></li>
</ul>
<p><strong>n_estimators</strong>:</p>
<ul class="simple">
<li><p>It defines the number of base estimators.</p></li>
<li><p>The default value is 10, but you should keep a higher value to get better performance.</p></li>
</ul>
<p><strong>learning_rate</strong>:</p>
<ul class="simple">
<li><p>This parameter controls the contribution of the estimators in the final combination.</p></li>
<li><p>There is a trade-off between learning_rate and n_estimators.</p></li>
</ul>
<p><strong>max_depth</strong>:</p>
<ul class="simple">
<li><p>Defines the maximum depth of the individual estimator.</p></li>
<li><p>Tune this parameter for best performance.</p></li>
</ul>
<p><strong>n_jobs</strong></p>
<ul class="simple">
<li><p>Specifies the number of processors it is allowed to use.</p></li>
<li><p>Set value to -1 for maximum processors allowed.</p></li>
</ul>
<p><strong>random_state</strong> :</p>
<ul class="simple">
<li><p>An integer value to specify the random data split.</p></li>
<li><p>A definite value of random_state will always produce same results if given with same parameters and training data.</p></li>
</ul>
<p>**Gradient Boosting or GBM **</p>
<p>It is another ensemble machine learning algorithm that works for both regression and classification problems. GBM uses the boosting technique, combining a number of weak learners to form a strong learner. Regression trees used as a base learner, each subsequent tree in series is built on the errors calculated by the previous tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grad_boost</span><span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grad_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">grad_boost</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9444444444444444
</pre></div>
</div>
</div>
</div>
<p><strong>Parameters</strong></p>
<p><strong>min_samples_split</strong></p>
<ul class="simple">
<li><p>Defines the minimum number of samples (or observations) which are required in a node to be considered for splitting.</p></li>
<li><p>Used to control over-fitting. Higher values prevent a model from learning relations which might be highly specific to the particular sample selected for a tree.</p></li>
</ul>
<p><strong>min_samples_leaf</strong></p>
<ul class="simple">
<li><p>Defines the minimum samples required in a terminal or leaf node.</p></li>
<li><p>Generally, lower values should be chosen for imbalanced class problems because the regions in which the minority class will be in the majority will be very small.</p></li>
</ul>
<p><strong>min_weight_fraction_leaf</strong></p>
<ul class="simple">
<li><p>Similar to min_samples_leaf but defined as a fraction of the total number of observations instead of an integer.</p></li>
</ul>
<p><strong>max_depth</strong></p>
<ul class="simple">
<li><p>The maximum depth of a tree.</p></li>
<li><p>Used to control over-fitting as higher depth will allow the model to learn relations very specific to a particular sample.</p></li>
<li><p>Should be tuned using CV.</p></li>
</ul>
<p><strong>max_leaf_nodes</strong></p>
<ul class="simple">
<li><p>The maximum number of terminal nodes or leaves in a tree.</p></li>
<li><p>Can be defined in place of max_depth. Since binary trees are created, a depth of ‘n’ would produce a maximum of 2^n leaves.</p></li>
<li><p>If this is defined, GBM will ignore max_depth.</p></li>
</ul>
<p><strong>max_features</strong></p>
<ul class="simple">
<li><p>The number of features to consider while searching for the best split. These will be randomly selected.</p></li>
<li><p>As a thumb-rule, the square root of the total number of features works great but we should check up to 30-40% of the total number of features.</p></li>
<li><p>Higher values can lead to over-fitting but it generally depends on a case to case scenario.</p></li>
</ul>
<p><strong>XGBoost</strong> (extreme Gradient Boosting) is an advanced implementation of the gradient boosting algorithm. XGBoost has proved to be a highly effective ML algorithm, extensively used in machine learning competitions and hackathons. XGBoost has high predictive power and is almost 10 times faster than the other gradient boosting techniques. It also includes a variety of regularization which reduces overfitting and improves overall performance. Hence it is also known as ‘<strong>regularized boosting</strong>‘ technique.</p>
<p>Let us see how XGBoost is comparatively better than other techniques:</p>
<p><strong>Regularization:</strong></p>
<p>Standard GBM implementation has no regularisation like XGBoost.
Thus XGBoost also helps to reduce overfitting.</p>
<p><strong>Parallel Processing:</strong></p>
<ul class="simple">
<li><p>XGBoost implements parallel processing and is faster than GBM .</p></li>
<li><p>XGBoost also supports implementation on Hadoop.</p></li>
</ul>
<p><strong>High Flexibility:</strong>
XGBoost allows users to define custom optimization objectives and evaluation criteria adding a whole new dimension to the model.</p>
<p><strong>Handling Missing Values:</strong>
XGBoost has an in-built routine to handle missing values.</p>
<p><strong>Tree Pruning:</strong>
XGBoost makes splits up to the max_depth specified and then starts pruning the tree backwards and removes splits beyond which there is no positive gain.</p>
<p><strong>Built-in Cross-Validation:</strong>
XGBoost allows a user to run a cross-validation at each iteration of the boosting process and thus it is easy to get the exact optimum number of boosting iterations in a single run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xgb_boost</span><span class="o">=</span><span class="n">xgb</span><span class="o">.</span><span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">xgb_boost</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">xgb_boost</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9444444444444444
</pre></div>
</div>
</div>
</div>
<p><strong>Parameters</strong></p>
<p><strong>nthread</strong></p>
<ul class="simple">
<li><p>This is used for parallel processing and the number of cores in the system should be entered..</p></li>
<li><p>If you wish to run on all cores, do not input this value. The algorithm will detect it automatically.</p></li>
</ul>
<p><strong>eta</strong></p>
<p>Analogous to learning rate in GBM.
Makes the model more robust by shrinking the weights on each step.</p>
<p><strong>min_child_weight</strong></p>
<ul class="simple">
<li><p>Defines the minimum sum of weights of all observations required in a child.</p></li>
<li><p>Used to control over-fitting. Higher values prevent a model from learning relations which might be highly specific to the particular sample selected for a tree.</p></li>
</ul>
<p><strong>max_depth</strong></p>
<ul class="simple">
<li><p>It is used to define the maximum depth.</p></li>
<li><p>Higher depth will allow the model to learn relations very specific to a particular sample.</p></li>
</ul>
<p><strong>max_leaf_nodes</strong></p>
<ul class="simple">
<li><p>The maximum number of terminal nodes or leaves in a tree.</p></li>
<li><p>Can be defined in place of max_depth. Since binary trees are created, a depth of ‘n’ would produce a maximum of 2^n leaves.</p></li>
<li><p>If this is defined, GBM will ignore max_depth.</p></li>
</ul>
<p><strong>gamma</strong></p>
<ul class="simple">
<li><p>A node is split only when the resulting split gives a positive reduction in the loss function. Gamma specifies the minimum loss reduction required to make a split.</p></li>
<li><p>Makes the algorithm conservative. The values can vary depending on the loss function and should be tuned.</p></li>
</ul>
<p><strong>subsample</strong></p>
<ul class="simple">
<li><p>Same as the subsample of GBM. Denotes the fraction of observations to be randomly sampled for each tree.</p></li>
<li><p>Lower values make the algorithm more conservative and prevent overfitting but values that are too small might lead to under-fitting.</p></li>
</ul>
<p><strong>colsample_bytree</strong></p>
<ul class="simple">
<li><p>It is similar to max_features in GBM.</p></li>
<li><p>Denotes the fraction of columns to be randomly sampled for each tree.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eclf</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Ada Boost&#39;</span><span class="p">,</span> <span class="n">ada_boost</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Grad Boost&#39;</span><span class="p">,</span> <span class="n">grad_boost</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;XG Boost&#39;</span><span class="p">,</span> <span class="n">xgb_boost</span><span class="p">)],</span> <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;hard&#39;</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">knn</span><span class="p">,</span> <span class="n">svc</span><span class="p">,</span> <span class="n">rg</span><span class="p">]</span>
<span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">ada_boost</span><span class="p">,</span> <span class="n">grad_boost</span><span class="p">,</span> <span class="n">xgb_boost</span><span class="p">,</span><span class="n">eclf</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Ada Boost&#39;</span><span class="p">,</span><span class="s1">&#39;Grad Boost&#39;</span><span class="p">,</span><span class="s1">&#39;XG Boost&#39;</span><span class="p">,</span><span class="s1">&#39;Ensemble&#39;</span><span class="p">]):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">) [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">label</span><span class="p">))</span>
   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.87 (+/- 0.14) [Ada Boost]
Accuracy: 0.91 (+/- 0.07) [Grad Boost]
Accuracy: 0.93 (+/- 0.07) [XG Boost]
Accuracy: 0.92 (+/- 0.09) [Ensemble]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="references-a-id-3-a-br">
<h3>References<a id="3"></a> <br><a class="headerlink" href="#references-a-id-3-a-br" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p><a class="reference external" href="https://www.mygreatlearning.com/blog/ensemble-learning">https://www.mygreatlearning.com/blog/ensemble-learning</a></p></li>
<li><p><a class="reference external" href="https://machinelearningmastery.com/model-averaging-ensemble-for-deep-learning-neural-networks/">https://machinelearningmastery.com/model-averaging-ensemble-for-deep-learning-neural-networks/</a></p></li>
<li><p><a class="reference external" href="https://www.analyticsvidhya.com/blog/2018/06/comprehensive-guide-for-ensemble-models/">https://www.analyticsvidhya.com/blog/2018/06/comprehensive-guide-for-ensemble-models/</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/ensemble-methods-in-machine-learning-what-are-they-and-why-use-them-68ec3f9fef5f">https://towardsdatascience.com/ensemble-methods-in-machine-learning-what-are-they-and-why-use-them-68ec3f9fef5f</a></p></li>
<li><p><a class="reference external" href="https://medium.com/&#64;rrfd/boosting-bagging-and-stacking-ensemble-methods-with-sklearn-and-mlens-a455c0c982de">https://medium.com/&#64;rrfd/boosting-bagging-and-stacking-ensemble-methods-with-sklearn-and-mlens-a455c0c982de</a></p></li>
<li><p><a class="reference external" href="https://www.toptal.com/machine-learning/ensemble-methods-machine-learning">https://www.toptal.com/machine-learning/ensemble-methods-machine-learning</a></p></li>
</ol>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="10_DBSCAN.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">10 DBSCAN</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="12_Nerual_Nets_with_Pytorch.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">12 Artificial Neural Networks</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By <a href="https://fangli-ying.github.io/">Dr. Fangli Ying</a><br/>
    
        &copy; Copyright 2023.<br/>
      <div class="extra_footer">
        Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>